#DropTable

extends Node
##
## ItemDB — Banco de itens global do jogo
## Cada item tem um ID numérico único.
## Qualquer cena do jogo pode acessar esses dados.
##

# Dicionário de todos os itens do jogo.
# O ID é a chave, e o valor é outro dicionário com propriedades.
var items := {
    1: { "name": "Moeda de Ouro", "type": "currency", "value": 1 },
    2: { "name": "Poção de Vida", "type": "consumable", "heal": 20 },
    3: { "name": "Espada Enferrujada", "type": "weapon", "atk": 4 },
    4: { "name": "Gema Rara", "type": "material", "rarity": "rare" },
    5: { "name": "Chave Velha", "type": "key", "opens": "porta_cave" }
}

func get_item(id: int) -> Dictionary:
    ##
    ## Retorna o dicionário do item pelo ID.
    ## Se o ID não existir, retorna null.
    ##
    if items.has(id):
        return items[id]
    return null




extends Node
##
## DropSystem — Sistema global de drop
## Recebe uma lista de IDs e retorna 1 item sorteado.
## Também pode usar pesos, porcentagens, etc no futuro.
##

func get_random_drop(drop_ids: Array[int]) -> Dictionary:
    ##
    ## drop_ids = lista de números representando itens possíveis
    ## Ex: [1, 5, 10]
    ##
    ## Retorna o item completo vindo da ItemDB.
    ## Caso a lista esteja vazia, retorna null.
    ##
    
    if drop_ids.is_empty():
        return null

    # Escolhe um ID aleatório da lista
    var chosen_id = drop_ids.pick_random()

    # Busca o item no ItemDB
    var item = ItemDB.get_item(chosen_id)

    return item



        #Usando no inimigo

##
## Lista de IDs de itens que este inimigo pode dropar.
## Você escolhe manualmente no editor.
##
@export var drop_ids: Array[int] = [1, 2, 4]


func morrer():
    ##
    ## Quando o inimigo morre, pedimos ao DropSystem
    ## para sortear 1 item usando a lista de IDs.
    ##
    
    var item = DropSystem.get_random_drop(drop_ids)

    if item != null:
        print("Inimigo dropou:", item["name"])
        spawn_item(item)
    else:
        print("Inimigo não dropou nada")

func spawn_item(item_data: Dictionary):
    ##
    ## item_data é o dicionário completo vindo da ItemDB.
    ##
    ## Aqui você instancia um item na cena.
    ## (Você pode ter uma cena ItemPickup.tscn, por exemplo)
    ##

    var item_scene = preload("res://objetos/ItemPickup.tscn").instantiate()
    item_scene.setup(item_data) # função para aplicar dados do item
    get_parent().add_child(item_scene)
    item_scene.global_position = global_position

